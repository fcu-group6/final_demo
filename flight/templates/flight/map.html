<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Posts</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN5oglylU8YSZWKyJNBJr17KpqieRT4IY&libraries=places"></script>
    <style>
        .return-button {
            position: fixed;
            top: 50px; /* 調整此值以控制按鈕的位置 */
            right: 10px; /* 靠近右側 */
            background-color: #343333;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 1em;
            z-index: 1000; /* 確保按鈕在所有元素之上 */
        }
        .return-button:hover {
            background-color: #636161;
        }

        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
    <script>
        let map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: { lat: 25.033, lng: 121.565 }
            });

            // 從 Django 模板中傳遞的地址資料
            const addresses = JSON.parse('{{ addresses_json|escapejs }}');

            // 添加地址到地圖
            addresses.forEach(addr => {
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address': addr.address }, (results, status) => {
                    if (status === 'OK') {
                        const position = results[0].geometry.location;
                        const marker = new google.maps.Marker({
                            position: position,
                            map: map,
                            title: addr.content
                        });

                        marker.addListener('click', () => {
                            window.location.href = `pin_post/?address=${encodeURIComponent(addr.address)}`;
                        });
                    } else {
                        console.log('Geocode was not successful for the following reason: ' + status);
                    }
                });
            });
        }

        window.onload = () => {
            initMap();
        };
    </script>
</head>
<body>
    <a href="http://127.0.0.1:8000/" class="return-button">Home</a>
    <div id="map"></div>
</body>
</html>
